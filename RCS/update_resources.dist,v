head	1.3;
access;
symbols;
locks; strict;
comment	@# @;


1.3
date	2004.05.17.18.12.40;	author kenneth;	state Exp;
branches;
next	1.2;

1.2
date	2001.10.31.22.44.07;	author kenneth;	state Exp;
branches;
next	1.1;

1.1
date	2001.09.12.21.20.04;	author kenneth;	state Exp;
branches;
next	;


desc
@update resource info
@


1.3
log
@update all attributes of configured resources
@
text
@#!___PYTHON_PATH_PLACEHOLDER___
# script to update the resource database

import Catalina

RESOURCE_DB = 'resource'
CONFIGURED_RESOURCES_DB = 'configured_resources'

cfg_resources_db_handle = Catalina.open_db(CONFIGURED_RESOURCES_DB,'read')
resource_db_handle = Catalina.open_db(RESOURCE_DB,'write')
resource_shelf = resource_db_handle[0]
resource_list = Catalina.get_resources_list()
cfg_resources_shelf = cfg_resources_db_handle[0]
cfg_resources_list = Catalina.get_configured_resources_list(resource_db_handle)

found_resource_names = []
for resource in resource_list :
    print "doing %s" % resource['name']
    if resource['State'] == 'None' :
        print "%s has state 'None'" % resource['name']
    found_resource_names.append(resource['name'])
    if resource_shelf.has_key(resource['name']) :
        for key in resource.keys() :
            Catalina.update_object_attribute(key, resource[key],
              resource_shelf[resource['name']], resource_db_handle)
            if resource['name'] == 'tf001i' :
                print "key: %s value: %s" % (key, resource[key])
    else :
        Catalina.insert_new_object(resource, resource_db_handle)

for resource in cfg_resources_list :
    if not resource['name'] in found_resource_names :
        if resource['name'] in resource_shelf.keys() :
            for key in resource.keys() :
                Catalina.update_object_attribute(key, resource[key],
                  resource_shelf[resource['name']], resource_db_handle)
            Catalina.update_object_attribute('State', None,
              resource_shelf[resource['name']], resource_db_handle)
        else :
            Catalina.insert_new_object(resource, resource_db_handle)

Catalina.close_db(resource_db_handle)
Catalina.close_db(cfg_resources_db_handle)
@


1.2
log
@changed unlocking order
@
text
@d34 3
@


1.1
log
@Initial revision
@
text
@d9 1
a12 1
cfg_resources_db_handle = Catalina.open_db(CONFIGURED_RESOURCES_DB,'read')
@
