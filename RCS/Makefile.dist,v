head	1.27;
access;
symbols;
locks; strict;
comment	@# @;


1.27
date	2007.01.25.19.17.53;	author mmargo;	state Exp;
branches;
next	1.26;

1.26
date	2006.06.08.00.00.31;	author mmargo;	state Exp;
branches;
next	1.25;

1.25
date	2002.04.09.17.40.42;	author kenneth;	state Exp;
branches;
next	1.24;

1.24
date	2002.04.09.16.45.41;	author kenneth;	state Exp;
branches;
next	1.23;

1.23
date	2002.04.09.03.12.47;	author kenneth;	state Exp;
branches;
next	1.22;

1.22
date	2002.03.13.17.51.44;	author kenneth;	state Exp;
branches;
next	1.21;

1.21
date	2002.03.05.17.44.25;	author kenneth;	state Exp;
branches;
next	1.20;

1.20
date	2002.03.04.20.05.42;	author kenneth;	state Exp;
branches;
next	1.19;

1.19
date	2002.03.04.20.05.00;	author kenneth;	state Exp;
branches;
next	1.18;

1.18
date	2002.02.28.00.01.43;	author kenneth;	state Exp;
branches;
next	1.17;

1.17
date	2002.02.27.23.48.48;	author kenneth;	state Exp;
branches;
next	1.16;

1.16
date	2002.02.27.23.44.44;	author kenneth;	state Exp;
branches;
next	1.15;

1.15
date	2002.02.25.19.20.36;	author kenneth;	state Exp;
branches;
next	1.14;

1.14
date	2002.02.22.19.21.01;	author kenneth;	state Exp;
branches;
next	1.13;

1.13
date	2002.02.01.21.08.52;	author kenneth;	state Exp;
branches;
next	1.12;

1.12
date	2002.01.16.23.21.43;	author kenneth;	state Exp;
branches;
next	1.11;

1.11
date	2002.01.11.20.19.59;	author kenneth;	state Exp;
branches;
next	1.10;

1.10
date	2001.12.14.18.56.59;	author kenneth;	state Exp;
branches;
next	1.9;

1.9
date	2001.11.28.22.05.38;	author kenneth;	state Exp;
branches;
next	1.8;

1.8
date	2001.11.01.00.20.52;	author kenneth;	state Exp;
branches;
next	1.7;

1.7
date	2001.11.01.00.17.21;	author kenneth;	state Exp;
branches;
next	1.6;

1.6
date	2001.10.31.21.54.31;	author kenneth;	state Exp;
branches;
next	1.5;

1.5
date	2001.09.12.23.52.52;	author kenneth;	state Exp;
branches;
next	1.4;

1.4
date	2001.09.12.23.12.24;	author kenneth;	state Exp;
branches;
next	1.3;

1.3
date	2001.09.12.23.03.30;	author kenneth;	state Exp;
branches;
next	1.2;

1.2
date	2001.09.11.22.09.48;	author kenneth;	state Exp;
branches;
next	1.1;

1.1
date	2001.09.11.19.45.08;	author kenneth;	state Exp;
branches;
next	;


desc
@Makefile for making catalina
@


1.27
log
@Change the copy commands with cp -f to force delete destination in case of copy failure. Easier to retry during installation failure
mmargo
@
text
@# Almost certainly will need to change these:
MANPATH=/home/kenneth/catalina/test/man
INSTALLDIR=/home/kenneth/catalina/test/install
ARCHIVEDIR=/home/kenneth/catalina/test/archive

# resource manager settings for LL
RESOURCEMANAGER=LL
RMLIBDIRS=-L/usr/lpp/LoadL/full/lib
RMINCDIRS=-I/usr/lpp/LoadL/full/include
RMLIBS=-lllapi -lm

# resource manager settings for PBS
#RESOURCEMANAGER=PBS
#RMLIBDIRS=-L/usr/local/lib
#RMINCDIRS=-I/usr/local/include
#RMLIBS=-lpbs

# cluster name (DS/Datastar is default)
CLUSTER_NAME=DS ## SDSC Datastar Power4 cluster
#CLUSTER_NAME=TG ## SDSC Teragrid IA64 linux cluster

RMCFLAGS=-g $(RMLIBDIRS) $(RMINCDIRS)

CATOWNER=kenneth
# user to own lock files, enables database write
CATLOCKOWNER=$(CATOWNER)
# group to own lock files, enables database write
CATLOCKGROUP=sys200
# This is the owner of the user_* files
# for Blue Horizon, this can be anyone, since the file will use
# setgid security for obtaining db writing privileges
CATUSEROWNER=$(CATOWNER)
CATUSERGROUP=$(CATLOCKGROUP)
# CATPERMS is the permissions for the user_* commands
# For Blue Horizon, it should be 2755, since it's sufficient to be
# setgid security to write to the db
#CATUSERPERMS=2755
CATUSERPERMS=755
#CATUSERCFLAGS=-D__USE_UNIX98 -D_SIGNAL_H
CATUSERCFLAGS=
PYTHONPATH=/usr/local/bin/python
KSHPATH=/usr/bin/ksh
CC=/usr/local/bin/gcc

# May need to change these:
AWK=/usr/bin/awk
WC=/usr/bin/wc
DATE=/usr/bin/date
NOHUP=/usr/bin/nohup
SLEEP=/usr/bin/sleep
GREP=/usr/bin/grep
PS=/usr/bin/ps
PSOPTIONS=-ef
CP=/usr/bin/cp
CHMOD=/usr/bin/chmod
CHOWN=/usr/bin/chown
MKDIR=/usr/bin/mkdir
SED=/usr/bin/sed
CAT=/usr/bin/cat
FIND=/usr/bin/find
RM=/usr/bin/rm
STTY=/usr/bin/stty

# Should not need to change anything below
SHELL=/bin/sh
CATALINA=Catalina.py
CATALINA_RM=Catalina_$(RESOURCEMANAGER).py
BINDJOB=bind_job_to_res
CANCELRES=cancel_res
CANCELSTANDING=cancel_standing_res
CHECKPY=check.py
COPYRIGHT=COPYRIGHT
CREATERES=create_res
CREATESTANDING=create_standing_res
CREATESYSTEM=create_system_res
DELJOB=del_job
DELPIDS=del_pids
FIRSTAVAILABLE=first_available
INITIALIZE=initialize_dbs
LASTAVAIL=last_available
LOADCONFIGURED=load_configured_resources
MOVEOLD=move_old_stuff
NODEREST=node_restriction_file.$(RESOURCEMANAGER)
NONCONFLICTING=nonconflicting
QJ=qj_$(RESOURCEMANAGER)
QM=qm_$(RESOURCEMANAGER)
QPRIORITY=query_priority
RESLIST=reslist
RESSTATUS=res_status
RUNJOB=rj_$(RESOURCEMANAGER)
RUNNINGFIRST=last_available_running_first
SCHEDULEJOBS=catalina_schedule_jobs
SCRATCHTEST=scratchtest.py
SETCONFIG=set_config
SETRES=set_res
SHOWBF=show_bf
SHOWFREE=show_free
SHOWCONFIG=show_config
SHOWEVENTS=show_events
SHOWGUESS=show_guess
SHOWQ=show_q
SHOWRES=show_res
SHOWRESOURCES=show_resources
SHOWSTANDING=show_standing_res
START=start.ksh
STOP=stop.py
TESTJOB=testjob.$(RESOURCEMANAGER)
TESTRES=testres9.py
UNBINDJOB=unbind_job_from_res
UPDATEJOBS=update_jobs
UPDATELOCALADMIN=update_local_admin
UPDATEPRIORITIES=update_job_priorities
UPDATEQOS=update_qos
UPDATERESOURCES=update_resources
UPDATERUNNING=update_runningstarting
UPDATESTANDING=update_standing_reservations
UPDATESYSTEM=update_system_priority
USERBINDWRAP=user_bind_res
USERBINDPY=user_bind_res.py
USERUNBINDWRAP=user_unbind_res
USERUNBINDPY=user_unbind_res.py
USERCANCELWRAP=user_cancel_res
USERCANCELPY=user_cancel_res.py
USERSETWRAP=user_set_res
USERSETPY=user_set_res.py

SHOWQ_P655=showq_p655
SHOWQ_P690=showq_p690

C_EXECUTABLE_FILES = $(QJ) $(QM) $(RUNJOB) $(USERCANCELWRAP) $(USERSETWRAP) $(USERBINDWRAP) $(USERUNBINDWRAP)

KSH_EXECUTABLE_FILES = $(START) $(SHOWQ_P655) $(SHOWQ_P690)

PY_EXECUTABLE_FILES = $(BINDJOB) \
	$(CANCELRES) $(CANCELSTANDING) $(CHECKPY) $(CREATERES) \
	$(CREATESTANDING) \
	$(CREATESYSTEM) $(DELJOB) $(DELPIDS) $(INITIALIZE) $(LOADCONFIGURED) \
	$(MOVEOLD) $(QPRIORITY) $(RESLIST) $(RESSTATUS) \
	$(SCHEDULEJOBS) $(SCRATCHTEST) \
	$(SETCONFIG) $(SETRES) $(SHOWBF) $(SHOWFREE) $(SHOWCONFIG) $(SHOWEVENTS) \
	$(SHOWGUESS) $(SHOWQ) $(SHOWRES) \
	$(SHOWRESOURCES) \
	$(SHOWSTANDING) $(STOP) $(TESTRES) $(UNBINDJOB) $(UPDATEJOBS) \
	$(UPDATELOCALADMIN) \
	$(UPDATEPRIORITIES) $(UPDATEQOS) $(UPDATERESOURCES) $(UPDATERUNNING) \
	$(UPDATESTANDING) \
	$(UPDATESYSTEM) $(USERBINDPY) $(USERCANCELPY) $(USERSETPY) $(USERUNBINDPY)

EXECUTABLE_FILES = $(C_EXECUTABLE_FILES) $(PY_EXECUTABLE_FILES) $(KSH_EXECUTABLE_FILES)

POLICY_FILES = $(NODEREST) $(NONCONFLICTING) $(RUNNINGFIRST) \
	$(FIRSTAVAILABLE) $(LASTAVAIL) $(COPYRIGHT)

PRODUCTION_FILES = $(CATALINA) $(CATALINA_RM) $(TESTJOB) \
	$(EXECUTABLE_FILES) $(POLICY_FILES)

all: MACH_SPECIFIC PYSUB KSHSUB $(C_EXECUTABLE_FILES)

install: all
	# Need to also create the initial dbs with the correct
	# permissions
	if \
		test ! -d $(INSTALLDIR) ; \
	then \
		$(MKDIR) -p $(INSTALLDIR) ; \
	fi
	if \
		test ! -d $(ARCHIVEDIR) ; \
	then \
		$(MKDIR) -p $(ARCHIVEDIR) ; \
	fi
	if \
		test ! -d $(MANPATH)/cat1 ; \
	then \
		$(MKDIR) -p $(MANPATH)/cat1 ; \
	fi
	# cp necessary files to INSTALLDIR
	$(CP) -f $(PRODUCTION_FILES) $(INSTALLDIR)
	cd $(INSTALLDIR) ; $(CHMOD) 755 $(EXECUTABLE_FILES)
	cd $(INSTALLDIR) ; $(CHMOD) 644 $(POLICY_FILES) $(TESTJOB)
        # chmod necessary INSTALLDIR/ directories and files
        # chown necessary INSTALLDIR/ directories and files
	- $(CHOWN) $(CATUSEROWNER):$(CATUSERGROUP) $(INSTALLDIR)/$(USERBINDWRAP)
	$(CHMOD) $(CATUSERPERMS) $(INSTALLDIR)/$(USERBINDWRAP)
	- $(CHOWN) $(CATUSEROWNER):$(CATUSERGROUP) $(INSTALLDIR)/$(USERUNBINDWRAP)
	$(CHMOD) $(CATUSERPERMS) $(INSTALLDIR)/$(USERUNBINDWRAP)
	- $(CHOWN) $(CATUSEROWNER):$(CATUSERGROUP) $(INSTALLDIR)/$(USERCANCELWRAP)
	$(CHMOD) $(CATUSERPERMS) $(INSTALLDIR)/$(USERCANCELWRAP)
	- $(CHOWN) $(CATUSEROWNER):$(CATUSERGROUP) $(INSTALLDIR)/$(USERSETWRAP)
	$(CHMOD) $(CATUSERPERMS) $(INSTALLDIR)/$(USERSETWRAP)

test:
	- $(INSTALLDIR)/$(TESTRES)

$(QJ): $(QJ).c
	$(CC) $(RMCFLAGS) -o $@@ $(QJ).c $(RMLIBS)

$(QJ).c: $(QJ).c.dist
	$(CAT) $@@.dist > $@@

$(QM): $(QM).c
	$(CC) $(RMCFLAGS) -o $@@ $(QM).c $(RMLIBS)

$(QM).c: $(QM).c.dist
	$(CAT) $@@.dist > $@@

$(RUNJOB): $(RUNJOB).c
	$(CC) $(RMCFLAGS) -o $@@ $(RUNJOB).c $(RMLIBS)

$(RUNJOB).c: $(RUNJOB).c.dist
	$(CAT) $@@.dist > $@@

$(USERBINDWRAP): $(USERBINDWRAP).c
	$(CC) $(CATUSERCFLAGS) -o $@@ $(USERBINDWRAP).c

$(USERBINDWRAP).c: $(USERBINDWRAP).c.dist
	$(CAT) $@@.dist | $(SED) 's@@___USER_BIND_RES_PLACEHOLDER___@@$(INSTALLDIR)/$(USERBINDPY)@@g' > $@@

$(USERUNBINDWRAP): $(USERUNBINDWRAP).c
	$(CC) $(CATUSERCFLAGS) -o $@@ $(USERUNBINDWRAP).c

$(USERUNBINDWRAP).c: $(USERUNBINDWRAP).c.dist
	$(CAT) $@@.dist | $(SED) 's@@___USER_UNBIND_RES_PLACEHOLDER___@@$(INSTALLDIR)/$(USERUNBINDPY)@@g' > $@@

# There's a problem with signal handling here
$(USERCANCELWRAP): $(USERCANCELWRAP).c
	$(CC) $(CATUSERCFLAGS) -o $@@ $(USERCANCELWRAP).c

$(USERCANCELWRAP).c: $(USERCANCELWRAP).c.dist
	$(CAT) $@@.dist | $(SED) 's@@___USER_CANCEL_RES_PLACEHOLDER___@@$(INSTALLDIR)/$(USERCANCELPY)@@g' > $@@

#$(USERCANCELWRAP).o: $(USERCANCELWRAP).c
#	$(CC) -c $(CATUSERCFLAGS) $(USERCANCELWRAP).c

$(USERSETWRAP): $(USERSETWRAP).c
	$(CC) $(CATUSERCFLAGS) -o $@@ $(USERSETWRAP).c

$(USERSETWRAP).c: $(USERSETWRAP).c.dist
	$(CAT) $@@.dist | $(SED) 's@@___USER_SET_RES_PLACEHOLDER___@@$(INSTALLDIR)/$(USERSETPY)@@g' > $@@

#$(USERSETWRAP).o: $(USERSETWRAP).c
#	$(CC) -c $(CATUSERCFLAGS) $(USERSETWRAP).c


MACH_SPECIFIC
	$(CP) -f $(SHOWBF).$(CLUSTER_NAME).dist $(SHOWBF).dist

	
PYSUB:
	for i in $(PY_EXECUTABLE_FILES) $(CATALINA) $(CATALINA_RM) ; do \
		$(CAT) $$i.dist | \
		$(SED) 's@@___PYTHON_PATH_PLACEHOLDER___@@$(PYTHONPATH)@@g' \
		| $(SED) 's@@___HOMEDIR_PLACEHOLDER___@@$(INSTALLDIR)@@g' \
		| $(SED) 's@@___ARCHIVEDIR_PLACEHOLDER___@@$(ARCHIVEDIR)@@g' \
		| $(SED) 's@@___RESOURCEMANAGER_PLACEHOLDER___@@$(RESOURCEMANAGER)@@g' \
                | $(SED) 's@@___QJ_PLACEHOLDER___@@$(QJ)@@g' \
                | $(SED) 's@@___QM_PLACEHOLDER___@@$(QM)@@g' \
                | $(SED) 's@@___RUNJOB_PLACEHOLDER___@@$(RUNJOB)@@g' \
		| $(SED) 's@@___PS_PLACEHOLDER___@@$(PS)@@g' \
		| $(SED) 's@@___PSOPTIONS_PLACEHOLDER___@@$(PSOPTIONS)@@g' \
		| $(SED) 's@@___GREP_PLACEHOLDER___@@$(GREP)@@g' \
		| $(SED) 's@@___CAT_PLACEHOLDER___@@$(CAT)@@g' \
		| $(SED) 's@@___WC_PLACEHOLDER___@@$(WC)@@g' \
		| $(SED) 's@@___AWK_PLACEHOLDER___@@$(AWK)@@g' \
		| $(SED) 's@@___DATE_PLACEHOLDER___@@$(DATE)@@g' \
		| $(SED) 's@@___HOMEDIR_PLACEHOLDER___@@$(INSTALLDIR)@@g' \
		| $(SED) 's@@___NOHUP_PLACEHOLDER___@@$(NOHUP)@@g' \
		> $$i ; \
	done

KSHSUB:
	for i in $(KSH_EXECUTABLE_FILES) ; do \
		$(CAT) $$i.dist \
		| $(SED) 's@@___KSH_PATH_PLACEHOLDER___@@$(KSHPATH)@@g' \
		| $(SED) 's@@___PS_PLACEHOLDER___@@$(PS)@@g' \
		| $(SED) 's@@___PSOPTIONS_PLACEHOLDER___@@$(PSOPTIONS)@@g' \
		| $(SED) 's@@___GREP_PLACEHOLDER___@@$(GREP)@@g' \
		| $(SED) 's@@___WC_PLACEHOLDER___@@$(WC)@@g' \
		| $(SED) 's@@___AWK_PLACEHOLDER___@@$(AWK)@@g' \
		| $(SED) 's@@___DATE_PLACEHOLDER___@@$(DATE)@@g' \
		| $(SED) 's@@___HOMEDIR_PLACEHOLDER___@@$(INSTALLDIR)@@g' \
		| $(SED) 's@@___NOHUP_PLACEHOLDER___@@$(NOHUP)@@g' \
		| $(SED) 's@@___SLEEP_PLACEHOLDER___@@$(SLEEP)@@g' \
		> $$i ; \
	done

clean:
	- $(RM) *.c *.o *.py
	- for i in $(PY_EXECUTABLE_FILES) $(CATALINA) $(CATALINA_RM) ; do \
		if \
		test -x $$i ; \
		then \
		$(RM) $$i ; \
		fi ; \
	done
@


1.26
log
@first stab,
add MACH_SPECIFIC key, to copy over show_bf.TG|DS.dist depending on the clustername
mmargo
@
text
@d178 1
a178 1
	$(CP) $(PRODUCTION_FILES) $(INSTALLDIR)
d246 1
a246 1
	$(CP) $(SHOWBF).$(CLUSTER_NAME).dist $(SHOWBF).dist
@


1.25
log
@added SHOWGUESS
@
text
@d18 4
d97 1
d127 3
d132 1
a132 1
KSH_EXECUTABLE_FILES = $(START)
d140 1
a140 1
	$(SETCONFIG) $(SETRES) $(SHOWBF) $(SHOWCONFIG) $(SHOWEVENTS) \
d157 1
a157 1
all: PYSUB KSHSUB $(C_EXECUTABLE_FILES)
d244 5
@


1.24
log
@took out CATUSERGROUP sed
@
text
@d95 1
d133 1
a133 1
	$(SHOWQ) $(SHOWRES) \
@


1.23
log
@added CATUSERGROUP ksh replacement
@
text
@a267 1
		| $(SED) 's@@___CATUSERGROUP_PLACEHOLDER___@@$(CATUSERGROUP)@@g' \
@


1.22
log
@added PSOPTIONS
@
text
@d268 1
@


1.21
log
@removed localdir, change schedule_jobs to catalina_schedule_jobs,
add del_job, del_pids
@
text
@d49 1
d246 1
d262 1
@


1.20
log
@reverted back to schedule_jobs
@
text
@a4 1
LOCALDIR=/tmp/localdisk
d71 2
d87 1
a87 1
SCHEDULEJOBS=schedule_jobs
d127 1
a127 1
	$(CREATESYSTEM) $(INITIALIZE) $(LOADCONFIGURED) \
a155 5
	fi
	if \
		test ! -d $(LOCALDIR) ; \
	then \
		$(MKDIR) -p $(LOCALDIR) ; \
@


1.19
log
@changed schedule_jobs to catalina_schedule_jobs
@
text
@d86 1
a86 1
SCHEDULEJOBS=catalina_schedule_jobs
@


1.18
log
@removed RESLISTCMD
@
text
@d86 1
a86 1
SCHEDULEJOBS=schedule_jobs
@


1.17
log
@changed reslist to python
@
text
@a5 1
RESLISTCMD=/home/kenneth/catalina/test/install/reslist
a243 1
		| $(SED) 's@@___RESLIST_CMD_PLACEHOLDER___@@$(RESLISTCMD)@@g' \
@


1.16
log
@added reslist
@
text
@d6 1
a6 1
RESLISTCMD=/usr/local/bin/reslist
d122 1
a122 1
KSH_EXECUTABLE_FILES = $(START) $(RESLIST)
d128 1
a128 1
	$(MOVEOLD) $(QPRIORITY) $(RESSTATUS) \
@


1.15
log
@added bind_reservation_to_job, unbind_reservation_from_job
@
text
@d83 1
d122 1
a122 1
KSH_EXECUTABLE_FILES = $(START)
@


1.14
log
@changed clean rm
@
text
@d110 4
d119 1
a119 1
C_EXECUTABLE_FILES = $(QJ) $(QM) $(RUNJOB) $(USERCANCELWRAP) $(USERSETWRAP)
d136 1
a136 1
	$(UPDATESYSTEM) $(USERCANCELPY) $(USERSETPY)
d177 4
d206 12
@


1.13
log
@added res_status
@
text
@d255 2
a256 2
clean: *.c *.o *.pm *.pl *.t
	- $(RM) $?
@


1.12
log
@use PY instead of WRAP
@
text
@d83 1
d123 1
a123 1
	$(MOVEOLD) $(QPRIORITY) \
@


1.11
log
@removed JOBNODEREST
@
text
@d203 1
a203 1
	$(CAT) $@@.dist | $(SED) 's@@___USER_CANCEL_RES_PLACEHOLDER___@@$(INSTALLDIR)/$(USERCANCELWRAP)@@g' > $@@
d212 1
a212 1
	$(CAT) $@@.dist | $(SED) 's@@___USER_SET_RES_PLACEHOLDER___@@$(INSTALLDIR)/$(USERSETWRAP)@@g' > $@@
@


1.10
log
@added update_local_admin
@
text
@a68 1
JOBNODEREST=node_restriction_file.$(RESOURCEMANAGER)
d136 1
a136 1
	$(FIRSTAVAILABLE) $(JOBNODEREST) $(LASTAVAIL) $(COPYRIGHT)
@


1.9
log
@changed to SP defaults
@
text
@d103 1
d129 1
@


1.8
log
@added COPYRIGHT to install
@
text
@d9 4
a12 4
#RESOURCEMANAGER=LL
#RMLIBDIRS=-L/usr/lpp/LoadL/full/lib
#RMINCDIRS=-I/usr/lpp/LoadL/full/include
#RMLIBS=-lllapi -lm
d15 4
a18 4
RESOURCEMANAGER=PBS
RMLIBDIRS=-L/usr/local/lib
RMINCDIRS=-I/usr/local/include
RMLIBS=-lpbs
d39 3
a41 3
PYTHONPATH=/usr/bin/python
KSHPATH=/bin/bash
CC=/usr/bin/gcc
d46 1
a46 1
DATE=/bin/date
d48 9
a56 9
SLEEP=/bin/sleep
GREP=/bin/grep
PS=/bin/ps
CP=/bin/cp
CHMOD=/bin/chmod
CHOWN=/bin/chown
MKDIR=/bin/mkdir
SED=/bin/sed
CAT=/bin/cat
d58 2
a59 2
RM=/bin/rm
STTY=/bin/stty
@


1.7
log
@removed modify
@
text
@d70 1
d135 1
a135 1
	$(FIRSTAVAILABLE) $(JOBNODEREST) $(LASTAVAIL)
@


1.6
log
@changed STOP to stop.py
@
text
@a76 1
MODIFY=modify_res
a120 1
	$(MODIFY) \
@


1.5
log
@*** empty log message ***
@
text
@d98 1
a98 1
STOP=stop.ksh
d116 1
a116 1
KSH_EXECUTABLE_FILES = $(START) $(STOP)
d128 1
a128 1
	$(SHOWSTANDING) $(TESTRES) $(UNBINDJOB) $(UPDATEJOBS) \
@


1.4
log
@removed BATCHPOL
@
text
@d225 3
@


1.3
log
@*** empty log message ***
@
text
@a64 1
BATCHPOL=batch_policy
d135 1
a135 1
POLICY_FILES = $(NODEREST) $(BATCHPOL) $(NONCONFLICTING) $(RUNNINGFIRST) \
@


1.2
log
@*** empty log message ***
@
text
@a64 1
ITERATE=schedule_jobs_iterate
a68 1
CHECK=check.ksh
d70 1
a70 1
CONFLICTJOB8=node_restriction_file.testjob8
a73 1
DEBUGUNLIM=debug_unlimited_reservation
a76 1
LOOKAHEAD=lookahead
d80 1
a80 1
NODEREST=node_restriction_file
a84 3
QRES=query_res
QUERYJOBS=query_jobs
RUNJOBS=run_jobs
d100 1
a100 2
#TESTJOB=testjob8
TESTJOB=jobfile.2
a107 1
UPDATESHORT=update_shortpools
d117 1
a117 1
KSH_EXECUTABLE_FILES = $(CHECK) $(START) $(STOP)
d119 1
a119 1
PY_EXECUTABLE_FILES = $(ITERATE) $(BINDJOB) \
d122 2
a123 2
	$(CREATESYSTEM) $(DEBUGUNLIM) $(INITIALIZE) $(LOADCONFIGURED) \
	$(LOOKAHEAD) $(MODIFY) \
d125 1
a125 1
	$(QRES) $(QUERYJOBS) $(RUNJOBS) $(SCHEDULEJOBS) $(SCRATCHTEST) \
a130 1
	$(UPDATESHORT) \
d137 1
a137 1
	$(FIRSTAVAILABLE) $(CONFLICTJOB8) $(LASTAVAIL)
@


1.1
log
@Initial revision
@
text
@d7 15
a21 6
SUBMITCMD=/usr/local/bin/qsub -q low
CANCELCMD=/usr/local/bin/qdel
#NODERESTCODE=if input_tuple[0]['ConfiguredClasses'] != None and re.search('normal', input_tuple[0]['ConfiguredClasses']) : result = 0
NODERESTCODE=if input_tuple[0]["'"ntype_string"'"] == "'"cluster"'" : result = 0
JOBSUFFIX=
USERNAMESUFFIX=\@@yylogin
d30 2
a31 2
CATUSEROWNER=kenneth
CATUSERGROUP=sys200
a61 11
#LLLIBDIR=/usr/lpp/LoadL/full/lib
#LLINCDIR=/usr/lpp/LoadL/full/include
#LIBS=-lllapi -lm
#LLCFLAGS=-g -I$(LLINCDIR) -L$(LLLIBDIR) $(LIBS)
PBSLIBDIRS=-L/usr/local/lib
#PBSINCDIR=/usr/local/include
PBSINCDIRS=-I/usr/local/include
PBSLIBS=-lpbs
#PBSCFLAGS=-g -I$(PBSINCDIR) -L$(PBSLIBDIR) $(PBSLIBS)
PBSCFLAGS=-g $(PBSLIBDIRS) $(PBSINCDIRS)
SUBMIT_OUTPUT_PATTERN=^(?P<job_id>\\\d+\\\.\\\w+)
d64 1
a64 2
#CATALINA_LL=Catalina_LL.py
CATALINA_PBS=Catalina_PBS.py
a76 3
GETINITMAP=getinitmap
#IBMQM=ibmqm
QM=qm
d86 2
d92 1
a92 1
RUNJOB=runjob
d124 1
a124 1
C_EXECUTABLE_FILES = $(GETINITMAP) $(QM) $(RUNJOB) $(USERCANCELWRAP) $(USERSETWRAP)
d149 1
a149 1
PRODUCTION_FILES = $(CATALINA) $(CATALINA_PBS) $(TESTJOB) \
d191 2
a192 2
$(GETINITMAP): $(GETINITMAP).c
	$(CC) $(PBSCFLAGS) -o $@@ $(GETINITMAP).c $(PBSLIBS)
d194 1
a194 1
$(GETINITMAP).c: $(GETINITMAP).c.dist
d198 1
a198 1
	$(CC) $(PBSCFLAGS) -o $@@ $(QM).c $(PBSLIBS)
d204 1
a204 1
	$(CC) $(PBSCFLAGS) -o $@@ $(RUNJOB).c $(PBSLIBS)
d229 1
a229 1
	for i in $(PY_EXECUTABLE_FILES) $(CATALINA) $(CATALINA_PBS) ; do \
d235 1
a235 9
		| $(SED) 's@@___JOB_SUBMIT_PLACEHOLDER___@@$(SUBMITCMD)@@g' \
		| $(SED) 's@@___JOB_CANCEL_PLACEHOLDER___@@$(CANCELCMD)@@g' \
		| $(SED) 's@@___JOB_SUFFIX_PLACEHOLDER___@@$(JOBSUFFIX)@@g' \
		| $(SED) 's@@___USERNAME_SUFFIX_PLACEHOLDER___@@$(USERNAMESUFFIX)@@g' \
		| $(SED) 's@@___SUBMIT_OUTPUT_PLACEHOLDER___@@$(SUBMIT_OUTPUT_PATTERN)@@g' \
		| $(SED) 's@@___NODE_REST_PLACEHOLDER___@@$(NODERESTCODE)@@g' \
		| $(SED) 's@@___TESTJOB_PLACEHOLDER___@@$(TESTJOB)@@g' \
		| $(SED) 's@@___CATLOCKGROUP_PLACEHOLDER___@@$(CATLOCKGROUP)@@g' \
		| $(SED) 's@@___CATLOCKOWNER_PLACEHOLDER___@@$(CATLOCKOWNER)@@g' \
d264 1
a264 1
	- for i in $(PY_EXECUTABLE_FILES) $(CATALINA) $(CATALINA_PBS) ; do \
@
